<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1 id="account-settings">Account settings</h1>
        <button onclick="location.href='dash.html'" id="gotopanel">Go to panel</button>
        <select class="change-lang" onchange="setLanguageSettings(this.value)">
            <option value="ru">–†—É—Å—Å–∫–∏–πüá∑üá∫</option>
            <option value="en" selected>Englishüá¨üáß</option>
            <option value="es">Espa√±olüá™üá∏</option>
        </select>
    </header>

    <main>
        <div class="wrapper">
            <form id="accountSettingsForm">
                <!-- –ê–≤–∞—Ç–∞—Ä–∫–∞ -->
                <div class="avatar-container">
                    <img id="avatar-preview" class="avatar" src="" alt="–ù–µ—Ç –ê–≤–∞—Ç–∞—Ä–∞:[">
                    <label for="avatar" id="load-avatar">Load avatar</label>
                    <input type="file" id="avatar" accept="image/*" class="select-file">
                </div>

                <!-- –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                <label for="username" id="username">Username</label>
                <input type="text" id="username" required>

                <!-- Email -->
                <label for="email" id="email">Email:</label>
                <input type="email" id="email" required>

                <!-- –ü–∞—Ä–æ–ª—å -->
                <label for="password" id="password">Password</label>
                <input type="password" id="password" required>

                <!-- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è -->
                <label for="confirmPassword" id="confirmation">Confirm password</label>
                <input type="password" id="confirmPassword" required>

                <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
                 <div class="control-panel">
                    <button type="submit" id="savechanges">Save Changes</button>
                    <button id="logout-btn" class="danger">Quit</button>
                    <button id="delete-account-btn" class="danger">Delete Account</button>
                 </div>
            </form>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ -->
    </main>

    <script>
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage
        const loggedInUser = localStorage.getItem('loggedInUser');
        const users = JSON.parse(localStorage.getItem('users')) || [];
        const currentUser = users.find(user => user.username === loggedInUser);

        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è –µ–≥–æ –¥–∞–Ω–Ω—ã–º–∏
        if (currentUser) {
            document.getElementById('username').value = currentUser.username;
            document.getElementById('email').value = currentUser.email;
            document.getElementById('password').value = currentUser.password;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è –∞–≤–∞—Ç–∞—Ä–∫–∞
            if (currentUser.avatar) {
                document.getElementById('avatar-preview').src = currentUser.avatar;
            } else {
                document.getElementById('avatar-preview').src = 'images/default-avatar.png'; // –ï—Å–ª–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏ –Ω–µ—Ç, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏
        document.getElementById('avatar').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('avatar-preview').src = e.target.result; // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É
                    currentUser.avatar = e.target.result; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É –≤ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                };
                reader.readAsDataURL(file); // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –∫–∞–∫ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
        document.getElementById('accountSettingsForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const newUsername = document.getElementById('username').value;
            const newEmail = document.getElementById('email').value;
            const newPassword = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
            if (newPassword !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            currentUser.username = newUsername;
            currentUser.email = newEmail;
            currentUser.password = newPassword;

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ localStorage
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('loggedInUser', newUsername); // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –≤ —Å–∏—Å—Ç–µ–º–µ

            alert('Account details have been successfully updated!');
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
        document.getElementById('logout-btn').addEventListener('click', function() {
            localStorage.removeItem('loggedInUser'); // –£–¥–∞–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            window.location.href = 'login.html'; // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
        });

        document.getElementById('delete-account-btn').addEventListener('click', function() {
            if (confirm('Are you sure you want to delete your account? This action is irreversible!')) {
                // –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –º–∞—Å—Å–∏–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                const updatedUsers = users.filter(user => user.username !== loggedInUser);
                localStorage.setItem('users', JSON.stringify(updatedUsers));

                // –£–¥–∞–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                localStorage.removeItem('loggedInUser');

                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–ª–∏ –≤—Ö–æ–¥–∞
                window.location.href = 'register.html';
            }
        });
    </script>
    <script src="script.js"></script>
</body>
</html>
