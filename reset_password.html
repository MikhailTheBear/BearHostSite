<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è</title>
    <link rel="icon" type="image/x-icon" href="images/resetpassword.ico">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Reggae+One&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>
    <header>
        <div class="logo">
            <h1>BearHost</h1>
        </div>
        <select class="change-lang">
            <option value="ru">–†—É—Å—Å–∫–∏–πüá∑üá∫</option>
            <option value="en" selected>Englishüá¨üáß</option>
            <option value="es">Espa√±olüá™üá∏</option>

        </select>
    </header>
    <div id="reset-password-form" class="wrapper">
        

    <script>
        // –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –≤ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
        const urlParams = new URLSearchParams(window.location.search);
        const resetToken = urlParams.get('token'); // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

        if (!resetToken) {
            document.body.innerHTML = '<h2>Invalid or missing password reset token!</h2>';
        } else {
            // –°–æ–∑–¥–∞–µ–º —Ñ–æ—Ä–º—É –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
            const formHtml = `
                <form id="resetForm">
                    <h1 id="resetpw">Reset Password</h1>
                    <div class="input-box">
                        <input type="password" id="newPassword" required placeholder="New password">
                        <i class='bx bxs-lock-alt'></i>
                    </div>
                    <div class="input-box">
                        <input type="password" id="confirmPassword" required placeholder="Confirm new password">
                        <i class='bx bxs-lock-alt'></i>
                    </div>
                    <button type="submit" class="btn">Reset Password</button>
                </form>
            `;
            
            // –í—Å—Ç–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É –≤ DOM
            document.getElementById('reset-password-form').innerHTML = formHtml;

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
            document.getElementById('resetForm').addEventListener('submit', function(e) {
                e.preventDefault();

                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;

                if (newPassword !== confirmPassword) {
                    alert("Passwords don't match");
                    return;
                }

                // –ó–¥–µ—Å—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ (localStorage –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
                // –ù–∞–ø—Ä–∏–º–µ—Ä, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ localStorage:
                let users = JSON.parse(localStorage.getItem('users')) || [];

                // –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Ç–æ–∫–µ–Ω—É (–¥–ª—è –ø—Ä–∏–º–µ—Ä–∞ –º–æ–∂–Ω–æ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç—å, —á—Ç–æ —Ç–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç username)
                const foundUser = users.find(user => user.resetToken === resetToken);

                if (foundUser) {
                    foundUser.password = newPassword;
                    localStorage.setItem('users', JSON.stringify(users));

                    alert('–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!');
                    window.location.href = 'login.html'; // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
                } else {
                    alert('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.');
                }
            });
        }
    </script>
    </div>
</body>
</html>